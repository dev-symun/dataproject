import streamlit as st
import pandas as pd
import folium
from streamlit_folium import st_folium

# ê¸°ë³¸ ì„¤ì •
st.set_page_config(page_title="ìƒí•˜ì´ ì—¬í–‰ ê³„íš", layout="wide")

st.title("ğŸ§³ ìƒí•˜ì´ ì—¬í–‰ ê³„íš í˜ì´ì§€")
st.markdown("ì¤‘êµ­ ìƒí•˜ì´ë¥¼ ì—¬í–‰í•˜ê¸° ìœ„í•œ ì¼ì •, ì˜ˆì‚°, ë°©ë¬¸ì§€ ì •ë³´ë¥¼ í•œëˆˆì— ì •ë¦¬í•©ë‹ˆë‹¤.")

# --- ì—¬í–‰ ê¸°ë³¸ ì •ë³´ ì…ë ¥ ---
st.header("âœˆï¸ ì—¬í–‰ ê¸°ë³¸ ì •ë³´")
col1, col2, col3 = st.columns(3)

with col1:
    days = st.number_input("ì—¬í–‰ ì¼ìˆ˜", min_value=1, max_value=14, value=4)
with col2:
    budget = st.number_input("ì´ ì˜ˆì‚° (ì›í™” ê¸°ì¤€)", min_value=0, value=1200000, step=100000)
with col3:
    season = st.selectbox("ì—¬í–‰ ì‹œê¸°", ["ë´„", "ì—¬ë¦„", "ê°€ì„", "ê²¨ìš¸"])

st.write(f"**ì—¬í–‰ ì¼ìˆ˜:** {days}ì¼ / **ì˜ˆì‚°:** {budget:,}ì› / **ì‹œê¸°:** {season}")

# --- ì¶”ì²œ ë°©ë¬¸ì§€ ë°ì´í„° ---
st.header("ğŸ“ ì¶”ì²œ ë°©ë¬¸ì§€ Top10")

places = [
    {"name": "ì™€ì´íƒ„(å¤–æ»©, The Bund)", "lat": 31.2401, "lon": 121.4905, "desc": "ìƒí•˜ì´ì˜ ëŒ€í‘œ ì•¼ê²½ ëª…ì†Œ"},
    {"name": "ë™ë°©ëª…ì£¼íƒ‘ (ä¸œæ–¹æ˜ç å¡”)", "lat": 31.2397, "lon": 121.4998, "desc": "ìƒí•˜ì´ ëœë“œë§ˆí¬ ì „ë§ëŒ€"},
    {"name": "ì˜ˆì› (è±«å›­)", "lat": 31.2272, "lon": 121.4925, "desc": "ì „í†µ ì¤‘êµ­ì‹ ì •ì›"},
    {"name": "ë‚œì§•ë£¨ ë³´í–‰ê°€ (å—äº¬è·¯æ­¥è¡Œè¡—)", "lat": 31.2381, "lon": 121.4900, "desc": "ì‡¼í•‘ ê±°ë¦¬ì™€ ì•¼ê²½ ëª…ì†Œ"},
    {"name": "ìƒí•˜ì´ ë°•ë¬¼ê´€", "lat": 31.2304, "lon": 121.4737, "desc": "ì¤‘êµ­ ì˜ˆìˆ ê³¼ ë¬¸í™”ì˜ ì¤‘ì‹¬"},
    {"name": "í‹°ì•ˆì¦ˆíŒ¡ (ç”°å­åŠ)", "lat": 31.2075, "lon": 121.4669, "desc": "ì˜ˆìˆ  ê±°ë¦¬ì™€ ì¹´í˜ ê³¨ëª©"},
    {"name": "ì‹ í†ˆë”” (æ–°å¤©åœ°)", "lat": 31.2205, "lon": 121.4750, "desc": "ìœ ëŸ½í’ ë ˆìŠ¤í† ë‘ ê±°ë¦¬"},
    {"name": "ìƒí•˜ì´ ë””ì¦ˆë‹ˆëœë“œ", "lat": 31.1440, "lon": 121.6570, "desc": "ì„¸ê³„ ìµœëŒ€ ê·œëª¨ì˜ ë””ì¦ˆë‹ˆëœë“œ ì¤‘ í•˜ë‚˜"},
    {"name": "í‘¸ë™ ë¦¬ë²„ì‚¬ì´ë“œ ê³µì›", "lat": 31.2427, "lon": 121.5111, "desc": "ë„ì‹œ ìŠ¤ì¹´ì´ë¼ì¸ ì¡°ë§ ëª…ì†Œ"},
    {"name": "ìƒí•˜ì´ íƒ€ì›Œ (ä¸Šæµ·ä¸­å¿ƒå¤§å¦)", "lat": 31.2336, "lon": 121.5055, "desc": "ì„¸ê³„ 2ìœ„ ë†’ì´ì˜ ì´ˆê³ ì¸µ ë¹Œë”©"},
]

# --- ì§€ë„ í‘œì‹œ ---
st.subheader("ğŸ—ºï¸ ìƒí•˜ì´ ì£¼ìš” ëª…ì†Œ ì§€ë„")

shanghai_center = [31.2304, 121.4737]
m = folium.Map(location=shanghai_center, zoom_start=12, tiles="CartoDB positron")

for p in places:
    folium.Marker(
        [p["lat"], p["lon"]],
        tooltip=p["name"],
        popup=f"<b>{p['name']}</b><br>{p['desc']}",
        icon=folium.Icon(color="red", icon="star")
    ).add_to(m)

st_folium(m, width=1000, height=600)

# --- ì¼ì •í‘œ (DataFrame ì…ë ¥) ---
st.header("ğŸ•“ ì—¬í–‰ ì¼ì •í‘œ ì‘ì„±")
st.markdown("ë°©ë¬¸ì§€ì™€ ì‹œê°„ ê³„íšì„ ììœ ë¡­ê²Œ ì¶”ê°€í•˜ì„¸ìš”.")

schedule = pd.DataFrame({
    "ë‚ ì§œ": [f"Day {i+1}" for i in range(days)],
    "ì£¼ìš” ë°©ë¬¸ì§€": ["" for _ in range(days)],
    "ì‹ì‚¬ ì¥ì†Œ": ["" for _ in range(days)],
    "ì˜ˆìƒ êµí†µìˆ˜ë‹¨": ["" for _ in range(days)],
    "ì˜ˆìƒ ë¹„ìš© (ì›)": [0 for _ in range(days)]
})

edited_schedule = st.data_editor(schedule, num_rows="dynamic")

total_estimated = edited_schedule["ì˜ˆìƒ ë¹„ìš© (ì›)"].sum()
remain = budget - total_estimated

st.metric(label="ì˜ˆìƒ ì´ ì§€ì¶œ", value=f"{total_estimated:,} ì›")
st.metric(label="ë‚¨ì€ ì˜ˆì‚°", value=f"{remain:,} ì›")

# --- íŒ ì„¹ì…˜ ---
st.header("ğŸ’¡ ì—¬í–‰ íŒ")
st.markdown("""
- **êµí†µ:** ì§€í•˜ì²  ì´ìš©ì´ ê°€ì¥ í¸ë¦¬í•˜ë©° ì•Œë¦¬í˜ì´(æ”¯ä»˜å®)ë¡œ QR ê²°ì œ ê°€ëŠ¥  
- **í™˜ì „:** ìœ„ì•ˆí™”(CNY) í™˜ì „ì€ êµ­ë‚´ ì€í–‰ ë˜ëŠ” ê³µí•­ì—ì„œ ë¯¸ë¦¬  
- **ìŒì‹ ì¶”ì²œ:** ìƒ¤ì˜¤ë¡±ë°”ì˜¤(å°ç¬¼åŒ…), ìƒí•˜ì´ì‹ ë³¶ìŒë©´, ë§ˆë¼íƒ•  
- **ì–¸ì–´:** ê°„ë‹¨í•œ ì¤‘êµ­ì–´ ì¸ì‚¬ë§ ìˆ™ì§€ ì¶”ì²œ  
- **ìœ ì‹¬/ë°ì´í„°:** eSIM ë˜ëŠ” í˜„ì§€ SIMì¹´ë“œ êµ¬ë§¤ ê°€ëŠ¥  
- **ì£¼ì˜:** ì¼ë¶€ ì§€ì—­ì—ì„œëŠ” êµ¬ê¸€ë§µë³´ë‹¤ ë°”ì´ë‘ë§µ ë˜ëŠ” ì• í”Œë§µì´ ë” ì •í™•í•¨  
""")

# --- ë§ˆë¬´ë¦¬ ---
st.success("âœˆï¸ ìƒí•˜ì´ ì—¬í–‰ ì¤€ë¹„ ì™„ë£Œ! ë©‹ì§„ ì—¬í–‰ì„ ì¦ê¸°ì„¸ìš”.")
